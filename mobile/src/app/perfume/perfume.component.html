<GridLayout rows="auto, *, auto" class="ns-dark bg-dark h-full">

  <StackLayout row="0" height="24"></StackLayout>

  <ScrollView row="1">
    <StackLayout class="px-6 pb-10">

      <StackLayout *ngIf="loading"
                   class="items-center mt-20">
        <ActivityIndicator busy="true"
                           color="#D3A54A" />
      </StackLayout>

      <ng-container *ngIf="!loading && details">

        <StackLayout class="pt-4 mb-4">
          <Label
            [text]="details.name"
            textWrap="true"
            class="text-2xl font-semibold text-text-primary mb-1"></Label>

          <Label
            [text]="details.brand"
            class="text-sm text-text-secondary"></Label>
        </StackLayout>

        <GridLayout
          class="rounded-3xl bg-dark-secondary h-56 mb-6 overflow-hidden">

          <Image
            [src]="perfumeImageSrc"
            stretch="aspectFill"
            opacity="0.35"
            blurRadius="25"
            borderRadius="24">
          </Image>

          <Image
            [src]="perfumeImageSrc"
            stretch="aspectFit"
            loadMode="async"
            class="rounded-lg"
            (loaded)="onImageLoaded($event)">
          </Image>

        </GridLayout>

        <StackLayout orientation="horizontal" class="mb-6 items-center">
          <Label
            text="&#xf005;"
            class="fas text-brand-gold text-sm mr-1"></Label>

          <Label
            [text]="details.avgRating.toFixed(1) + ' · ' + details.ratingCount + ' reviews'"
            class="text-text-secondary text-sm"></Label>
        </StackLayout>

        <StackLayout class="mb-4">
          <FlexboxLayout flexWrap="wrap">
            <StackLayout *ngFor="let g of details.groups"
                        class="rounded-xl px-3 py-2 mr-2 mb-2"
                        [style.borderWidth]="1"
                        [style.borderColor]="getGroupColor(g)"
                        [style.backgroundColor]="'transparent'">
              <Label
                [text]="g"
                class="text-xs"
                [style.color]="getGroupColor(g)">
              </Label>
            </StackLayout>
          </FlexboxLayout>
        </StackLayout>

        <StackLayout class="mb-4">

          <StackLayout *ngFor="let group of details.noteGroups"
                       class="mb-2">

            <Label
              [text]="noteTypeLabel(group.type)"
              class="text-xs text-text-secondary mb-2"></Label>

            <FlexboxLayout flexWrap="wrap">
              <StackLayout *ngFor="let n of group.notes"
                           class="bg-dark-secondary rounded-xl px-3 py-2 mr-2 mb-2">
                <Label
                  [text]="n.name"
                  class="text-xs text-text-primary"></Label>
              </StackLayout>
            </FlexboxLayout>

          </StackLayout>

        </StackLayout>

        <StackLayout>

          <Label text="Reviews"
                 class="text-lg font-semibold text-text-primary mb-4"></Label>

          <StackLayout *ngFor="let r of details.reviews"
                       class="mb-4 bg-dark-secondary rounded-2xl px-4 py-3">

            <GridLayout columns="*, auto"
                        class="mb-1">
              <Label
                [text]="r.author"
                class="text-xs text-text-primary font-semibold"></Label>

              <Label
                [text]="'★ ' + r.rating"
                col="1"
                class="text-xs text-brand-gold"></Label>
            </GridLayout>

            <Label
              *ngIf="r.text"
              [text]="r.text"
              textWrap="true"
              class="text-xs text-text-secondary"></Label>

            <Label
              [text]="r.createdAt | date:'mediumDate'"
              class="text-2xs text-text-secondary mt-2"></Label>

          </StackLayout>

          <StackLayout class="items-center mt-2">
            <Label text="See all reviews"
                   class="text-xs text-brand-gold"
                   opacity="0.7"></Label>
          </StackLayout>

        </StackLayout>

      </ng-container>

    </StackLayout>
  </ScrollView>

  <app-footer row="2"></app-footer>

</GridLayout>
