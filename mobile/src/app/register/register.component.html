<GridLayout rows="*" class="ns-dark bg-dark">
  <ScrollView row="0" class="bg-dark mt-16">
    <StackLayout class="px-6 pb-8">

      <Label
        text="Join FragranceLog"
        class="text-2xl font-semibold text-text-primary mb-1">
      </Label>

      <Label
        text="Start building your perfume collection"
        class="text-sm text-text-secondary mb-6">
      </Label>

      <StackLayout [formGroup]="form">

        <StackLayout class="mb-4">
          <Label
            text="Username"
            class="text-xs text-text-secondary mb-1">
          </Label>

          <TextField
            formControlName="username"
            class="bg-dark-secondary text-text-primary rounded-2xl px-4 py-3"
            hint="username">
          </TextField>
        </StackLayout>

        <StackLayout class="mb-4">
          <Label
            text="Email"
            class="text-xs text-text-secondary mb-1">
          </Label>

          <TextField
            formControlName="email"
            keyboardType="email"
            class="bg-dark-secondary text-text-primary rounded-2xl px-4 py-3"
            hint="you@example.com">
          </TextField>
        </StackLayout>

        <StackLayout class="mb-4">
          <Label
            text="Password"
            class="text-xs text-text-secondary mb-1">
          </Label>

          <GridLayout
            columns="*, auto"
            class="bg-dark-secondary rounded-2xl">

            <TextField
              col="0"
              formControlName="password"
              [secure]="!showPassword"
              class="px-4 py-3 text-text-primary"
              backgroundColor="transparent"
              borderWidth="0"
              fontFamily="Inter"
              hint="Create a strong password">
            </TextField>

            <GridLayout
              col="1"
              width="40"
              height="40"
              class="items-center justify-center"
              [opacity]="form.get('password')?.value ? 1 : 0"
              [isUserInteractionEnabled]="!!form.get('password')?.value"
              (tap)="togglePassword()">

              <Label
                [text]="showPassword ? '&#xf070;' : '&#xf06e;'"
                class="fas text-text-secondary text-sm"
                verticalAlignment="center"
                horizontalAlignment="center">
              </Label>

            </GridLayout>

          </GridLayout>
        </StackLayout>

        <StackLayout
          #strengthWrapper
          [visibility]="showStrength ? 'visible' : 'collapse'"
          class="mb-1">

          <GridLayout
            height="6"
            class="bg-dark rounded-full mb-3">

            <GridLayout
              #strengthFill
              height="6"
              scaleX="0"
              originX="0"
              class="rounded-full"
              [class.bg-red-500]="passwordStrength.score <= 2"
              [class.bg-yellow-500]="passwordStrength.score === 3"
              [class.bg-green-500]="passwordStrength.score >= 4">
            </GridLayout>
          </GridLayout>

          <StackLayout #checklist class="gap-1 mb-4">

            <Label
              text="• At least 8 characters"
              class="text-xs"
              [class.text-green-400]="passwordStrength.length"
              [class.text-text-secondary]="!passwordStrength.length">
            </Label>

            <Label
              text="• Lowercase letter"
              class="text-xs"
              [class.text-green-400]="passwordStrength.lowercase"
              [class.text-text-secondary]="!passwordStrength.lowercase">
            </Label>

            <Label
              text="• Uppercase letter"
              class="text-xs"
              [class.text-green-400]="passwordStrength.uppercase"
              [class.text-text-secondary]="!passwordStrength.uppercase">
            </Label>

            <Label
              text="• Digit"
              class="text-xs"
              [class.text-green-400]="passwordStrength.digit"
              [class.text-text-secondary]="!passwordStrength.digit">
            </Label>

            <Label
              text="• Special character"
              class="text-xs"
              [class.text-green-400]="passwordStrength.special"
              [class.text-text-secondary]="!passwordStrength.special">
            </Label>

          </StackLayout>

        </StackLayout>

      </StackLayout>

      <GridLayout
        class="mt-6 bg-brand-gold rounded-2xl"
        [class.opacity-50]="form.invalid || loading || passwordStrength.score < 5"
        [isEnabled]="!loading && passwordStrength.score === 5"
        (tap)="!loading && onSubmit()">

        <Label
          text="Create account"
          class="text-bg-dark font-semibold uppercase py-3"
          horizontalAlignment="center"
          [opacity]="loading ? 0 : 1">
        </Label>

        <ActivityIndicator
          [busy]="loading"
          color="#0D0D0D"
          [opacity]="loading ? 1 : 0"
          horizontalAlignment="center">
        </ActivityIndicator>

      </GridLayout>

      <Label
        *ngIf="error"
        [text]="error"
        textWrap="true"
        style="line-height: 8;"
        class="mt-3 text-xs text-red-500">
      </Label>

      <StackLayout class="mt-10 items-center">
        <Label
          text="Already have an account?"
          class="text-xs text-text-secondary mb-1">
        </Label>

        <Label
          text="Log in"
          class="text-sm text-highlight font-semibold"
          (tap)="goToLogin()">
        </Label>
      </StackLayout>

    </StackLayout>
  </ScrollView>
</GridLayout>
